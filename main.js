/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var L=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var D=Object.prototype.hasOwnProperty;var F=(g,a)=>{for(var t in a)L(g,t,{get:a[t],enumerable:!0})},A=(g,a,t,r)=>{if(a&&typeof a=="object"||typeof a=="function")for(let e of H(a))!D.call(g,e)&&e!==t&&L(g,e,{get:()=>a[e],enumerable:!(r=R(a,e))||r.enumerable});return g};var P=g=>A(L({},"__esModule",{value:!0}),g);var O={};F(O,{default:()=>C,findLinkedBlocks:()=>W});module.exports=P(O);var m=require("obsidian");async function W(g,a){let t=[],r=a.vault.getMarkdownFiles();for(let s of r){let n=a.metadataCache.getFileCache(s);if(!(n!=null&&n.listItems))continue;let o=(await a.vault.cachedRead(s)).split(`
`),c=n.listItems;for(let l of c){let u=o[l.position.start.line];if(!u.includes("[["))continue;let p=u.match(/\[\[(.*?)\]\]/g)||[];for(let d of p){let k=d.slice(2,-2).split("|")[0],f=a.metadataCache.getFirstLinkpathDest(k,s.path);if((f==null?void 0:f.path)===g.path){let b=l.position.start.line,h=l.position.end.line;for(;h<o.length-1;){let v=o[h+1];if(v.trim()===""||v.startsWith("-")||v.startsWith("*")||v.match(/^\s*\d+\./))break;h++}let y=o.slice(b,h+1).join(`
`);t.push({file:s,block:y});break}}}}let e=new Map;for(let{file:s,block:n}of t){let i=s.path;e.has(i)||e.set(i,{file:s,blocks:[]}),e.get(i).blocks.push(n)}return Array.from(e.values())}var E="search-results-view",w=class extends m.ItemView{constructor(t){super(t);this.results=[];this.dropdown=null;this.currentSearches=[]}updatePropertyButtons(){if(!this.propertyButtonsContainer||(this.propertyButtonsContainer.innerHTML="",this.currentSearches.length===0))return;let t=new Map;for(let e of this.results){let s=this.app.metadataCache.getFileCache(e.file);if(s!=null&&s.frontmatter)for(let[n,i]of Object.entries(s.frontmatter))i!=null&&(t.has(n)||t.set(n,new Set),Array.isArray(i)?i.forEach(o=>{o!=null&&t.get(n).add(o.toString())}):t.get(n).add(i.toString()))}for(let[e,s]of t){let n=this.propertyButtonsContainer.createEl("button",{cls:"property-button"}),i=n.createSpan();i.style.display="flex",i.style.alignItems="center",i.style.gap="2px";let o=i.createSpan({text:e});o.style.fontSize="0.8em";let c=i.createSpan({text:"\u25BC"});c.style.fontSize="0.6em",c.style.opacity="0.7",n.style.padding="1px 6px",n.style.fontSize="0.8em",n.style.borderRadius="12px",n.style.backgroundColor="var(--background-secondary)",n.style.border="none",n.style.cursor="pointer",n.style.display="flex",n.style.alignItems="center",n.addEventListener("click",l=>{this.showPropertyDropdown(n,e,Array.from(s))})}this.propertyButtonsContainer.createEl("button",{text:"\u21BB",cls:"refresh-button"}).addEventListener("click",e=>{this.performSearch()})}showPropertyDropdown(t,r,e){this.containerEl.querySelectorAll(".property-dropdown").forEach(c=>c.remove());let s=createDiv({cls:"property-dropdown"});s.style.position="absolute",s.style.backgroundColor="var(--background-primary)",s.style.border="1px solid var(--background-modifier-border)",s.style.borderRadius="4px",s.style.boxShadow="0 2px 10px rgba(0,0,0,0.1)",s.style.zIndex="1000",s.style.maxHeight="200px",s.style.overflowY="auto";let n=t.getBoundingClientRect(),i=this.containerEl.getBoundingClientRect();s.style.top=`${n.bottom-i.top+5}px`,s.style.left=`${n.left-i.left}px`,this.containerEl.appendChild(s),e.forEach(c=>{let l=s.createDiv({text:c,cls:"property-dropdown-item"});l.style.padding="6px 12px",l.style.cursor="pointer",l.addEventListener("click",()=>{this.addSearchTerm(`${r}:${c}`),s.remove()}),l.addEventListener("mouseover",()=>{l.style.backgroundColor="var(--background-secondary)"}),l.addEventListener("mouseout",()=>{l.style.backgroundColor=""})});let o=c=>{let l=c.target;s.contains(l)||(s.remove(),document.removeEventListener("click",o))};setTimeout(()=>{document.addEventListener("click",o)},0)}getViewType(){return E}getDisplayText(){return"Link Search"}getIcon(){return"search"}async onOpen(){let t=this.containerEl.children[1];t.empty(),t.style.padding="10px";let r=t.createDiv();r.style.marginBottom="20px",r.style.position="relative",r.style.padding="15px",r.style.backgroundColor="var(--background-secondary)",r.style.borderRadius="8px",r.style.border="1px solid var(--background-modifier-border)";let e=r.createEl("form");e.style.display="flex",e.style.gap="10px",e.style.marginBottom="10px",this.searchInput=e.createEl("input",{type:"text",placeholder:"Type a link name and press Enter..."}),this.searchInput.style.flexGrow="1",this.searchInput.addClass("search-input");let s=r.createDiv();this.propertyButtonsContainer=t.createDiv(),this.propertyButtonsContainer.style.display="flex",this.propertyButtonsContainer.style.flexWrap="wrap",this.propertyButtonsContainer.style.gap="5px",this.propertyButtonsContainer.style.marginBottom="10px";let n=t.createDiv();n.style.marginBottom="10px",this.tagsContainer=n.createDiv(),this.tagsContainer.style.maxHeight="12.5rem",this.tagsContainer.style.overflowY="auto";let i=t.createDiv();i.style.marginBottom="10px",this.suggestedTagsContainer=i.createDiv(),this.suggestedTagsContainer.style.maxHeight="12.5rem",this.suggestedTagsContainer.style.overflowY="auto",this.suggestedTagsContainer.createEl("span",{text:"Suggestions: ",cls:"suggested-label"}),this.dropdown=new T(this.app,this.searchInput,s,o=>{this.addSearchTerm(o)}),this.resultsContainer=t.createDiv(),this.resultsContainer.style.overflowY="auto",this.resultsContainer.style.height="auto",this.resultsContainer.style.borderTop="1px solid var(--background-modifier-border)",this.resultsContainer.style.paddingTop="15px",this.resultsContainer.style.marginTop="10px",e.addEventListener("submit",o=>{o.preventDefault(),this.addSearchTerm(this.searchInput.value)}),this.searchInput.focus()}addSearchTerm(t){t=t.trim(),t&&(this.currentSearches.includes(t)||(this.currentSearches.push(t),this.renderSearchTags(),this.performSearch()),this.searchInput.value="",this.searchInput.focus())}renderSearchTags(){this.tagsContainer.empty();for(let t of this.currentSearches){let r=t.length>45?t.slice(0,45)+" \u2026":t,e=this.tagsContainer.createEl("button",{title:t,text:r,cls:"search-tag"});e.style.padding="2px 8px",e.style.borderRadius="12px",e.style.backgroundColor="var(--background-secondary)",e.style.border="none",e.style.cursor="pointer",e.style.margin="4px",e.style.gap="4px";let s=e.createSpan({text:"\u2715",cls:"tag-close"});s.style.fontSize="0.8em",e.addEventListener("click",n=>{n.stopPropagation(),this.removeSearchTerm(t)})}}async performSearch(){if(this.currentSearches.length===0){this.showMessage("No search terms"),this.results=[],this.updatePropertyButtons(),this.updateSuggestedTags();return}this.showMessage("Searching...");try{let t=await this.findLinkedBlocksForMultiple(this.currentSearches);this.setResults(t)}catch(t){this.showMessage("Error during search: "+t.message)}}async findLinkedBlocksForMultiple(t){let r={},e=[];if(t.forEach(o=>{if(o.includes(":")){let[c,l]=o.split(":").map(u=>u.trim());r[c]=l}else e.push(o)}),e.length===0&&Object.keys(r).length===0)return[];let s=[],n=this.app.vault.getMarkdownFiles();for(let o of n){if(Object.keys(r).length>0){let p=this.app.metadataCache.getFileCache(o),d=(p==null?void 0:p.frontmatter)||{},k=!0;for(let[f,b]of Object.entries(r)){let h=d[f];if(h==null){k=!1;break}let y=!1;if(Array.isArray(h)?y=h.includes(b):y=h.toString()===b,!y){k=!1;break}}if(!k)continue}let c=this.app.metadataCache.getFileCache(o);if(!(c!=null&&c.sections))continue;let u=(await this.app.vault.cachedRead(o)).split(`
`);for(let p of c.sections){if(!p.position||p.type!=="paragraph"&&p.type!=="table"&&p.type!=="list"&&p.type!=="footnoteDefinition"&&p.type!=="callout")continue;let d=p.position.start.line,k=p.position.end.line;if(p.type==="list"){let b=(c.listItems||[]).filter(h=>h.position.start.line>=d&&h.position.end.line<=k);for(let h of b){let y=h.position.start.line,v=h.position.end.line,x=u.slice(y,v+1).join(`
`);if(!x.includes("[["))continue;let I=(x.match(/\[\[(.*?)\]\]/g)||[]).map(S=>S.slice(2,-2).split("|")[0].trim());e.length>0&&!e.every(M=>I.some(B=>B.toLowerCase()===M.toLowerCase()))||s.push({file:o,block:x,startLine:y,endLine:v})}}else{let f=u.slice(d,k+1).join(`
`);if(!f.includes("[["))continue;let h=(f.match(/\[\[(.*?)\]\]/g)||[]).map(y=>y.slice(2,-2).split("|")[0].trim());if(e.length>0&&!e.every(v=>h.some(x=>x.toLowerCase()===v.toLowerCase())))continue;s.push({file:o,block:f,startLine:d,endLine:k})}}}let i=new Map;for(let{file:o,block:c,startLine:l,endLine:u}of s){let p=o.path;i.has(p)||i.set(p,{file:o,blocks:[]}),i.get(p).blocks.push({content:c,startLine:l,endLine:u})}return Array.from(i.values())}removeSearchTerm(t){this.currentSearches=this.currentSearches.filter(r=>r!==t),this.renderSearchTags(),this.performSearch(),this.currentSearches.length===0&&this.updateSuggestedTags()}addSearchTag(t){this.tagsContainer.empty();let r=t.length>45?t.slice(0,45)+" \u2026":t,e=this.tagsContainer.createEl("button",{title:t,text:r,cls:"search-tag"});e.style.padding="2px 8px",e.style.borderRadius="12px",e.style.backgroundColor="var(--background-secondary)",e.style.border="none",e.style.cursor="pointer",e.style.display="flex",e.style.alignItems="center",e.style.gap="4px";let s=e.createSpan({text:"\u2715",cls:"tag-close"});s.style.fontSize="0.8em",e.addEventListener("click",()=>{this.searchInput.value="",this.tagsContainer.empty(),this.resultsContainer.empty(),this.results=[],this.searchInput.focus()})}setResults(t){this.results=t,this.renderResults(),this.updatePropertyButtons(),this.updateSuggestedTags()}updateSuggestedTags(){if(!this.suggestedTagsContainer||(this.suggestedTagsContainer.innerHTML="",this.currentSearches.length===0))return;let t=this.suggestedTagsContainer.createEl("span",{text:"Related links: ",cls:"suggested-label"});t.style.marginRight="5px";let r=new Set;for(let e of this.results)for(let s of e.blocks){let n=s.content.match(/\[\[(.*?)\]\]/g)||[];for(let i of n){let o=i.slice(2,-2).split("|")[0].trim();o&&!this.currentSearches.includes(o)&&r.add(o)}}r.forEach(e=>{let s=e.length>45?e.slice(0,45)+" \u2026":e,n=this.suggestedTagsContainer.createEl("button",{title:e,text:s,cls:"suggested-tag"});n.style.padding="2px 8px",n.style.borderRadius="12px",n.style.backgroundColor="var(--background-primary-alt)",n.style.border="none",n.style.cursor="pointer",n.style.marginLeft="3px",n.addEventListener("click",()=>{this.addSearchTerm(e)})})}showMessage(t){this.resultsContainer.empty(),this.resultsContainer.createEl("p",{text:t})}renderResults(){if(this.resultsContainer.empty(),this.results.length===0){this.resultsContainer.createEl("p",{text:"No matches found."});return}for(let t of this.results){let s=this.resultsContainer.createEl("div",{cls:"search-result-file"}).createDiv({cls:"file-header-content"}).createEl("h4",{text:t.file.basename});s.style.cursor="pointer",s.style.display="inline-block",s.style.marginRight="10px",s.addEventListener("click",()=>{this.app.workspace.openLinkText(t.file.path,"")});for(let n of t.blocks){let i=this.resultsContainer.createDiv();i.style.position="relative",i.style.marginBottom="1.5em",i.style.backgroundColor="var(--background-secondary)",i.style.padding="1em",i.style.borderRadius="8px",i.style.border="1px solid var(--background-modifier-border)",i.style.boxShadow="0 2px 4px rgba(0,0,0,0.05)";let o=i.createDiv();o.style.position="relative",o.style.padding="1em",o.style.borderRadius="6px",o.style.backgroundColor="var(--background-primary)";let c=o.createDiv();m.MarkdownRenderer.render(this.app,n.content,c,t.file.path,this);let l=i.createDiv({cls:"block-link-container"});l.style.position="absolute",l.style.top="10px",l.style.right="10px",l.style.display="flex",l.style.gap="8px";let u=l.createEl("a",{href:"#",cls:"block-action",title:"Copy block content"});u.innerHTML="\u{1F4CB}",u.addEventListener("click",d=>{d.preventDefault(),navigator.clipboard.writeText(n.content),new m.Notice("Block content copied to clipboard")});let p=l.createEl("a",{href:"#",cls:"block-action",title:"Open link"});p.innerHTML="\u{1F517}",p.addEventListener("click",d=>{d.preventDefault(),this.openBlockReference(t.file,n)}),[u,p].forEach(d=>{d.style.transition="all 0.2s ease",d.style.textDecoration="none",d.style.fontSize="1.1em",d.style.cursor="pointer",d.style.opacity="0.7",d.addEventListener("mouseover",()=>{d.style.opacity="1",d.style.transform="scale(1.2)"}),d.addEventListener("mouseout",()=>{d.style.opacity="0.7",d.style.transform="scale(1)"})})}}}async openBlockReference(t,r){let e=this.app.workspace.getLeaf(!1);if(await e.openFile(t),e.view instanceof m.MarkdownView){let s=e.view.editor;s.setCursor({line:r.startLine,ch:0}),s.scrollIntoView({from:{line:Math.max(0,r.startLine-3),ch:0},to:{line:r.endLine+3,ch:0}},!0),this.highlightBlock(s,r.startLine,r.endLine)}}highlightBlock(t,r,e){let s=t.cm;if(!s)return;s.getAllMarks().forEach(c=>c.clear());let n={line:r,ch:0},i={line:e,ch:t.getLine(e).length},o=s.markText(n,i,{className:"block-highlight"});setTimeout(()=>o.clear(),3e3)}},T=class{constructor(a,t,r,e){this.items=[];this.selectedIndex=-1;this.app=a,this.inputEl=t,this.containerEl=r,this.onSelectCallback=e,this.suggestionsEl=this.containerEl.createDiv("suggestion-container"),this.suggestionsEl.style.position="absolute",this.suggestionsEl.style.zIndex="1000",this.suggestionsEl.style.backgroundColor="var(--background-primary)",this.suggestionsEl.style.border="1px solid var(--background-modifier-border)",this.suggestionsEl.style.borderRadius="4px",this.suggestionsEl.style.boxShadow="0 2px 10px rgba(0,0,0,0.1)",this.suggestionsEl.style.maxHeight="200px",this.suggestionsEl.style.overflowY="auto",this.suggestionsEl.style.display="none",this.inputHandler=this.onInput.bind(this),this.keydownHandler=this.onKeyDown.bind(this),this.inputEl.addEventListener("input",this.inputHandler),this.inputEl.addEventListener("keydown",this.keydownHandler)}getAllLinkTargets(){let t=this.app.vault.getMarkdownFiles().map(s=>s.basename),r=new Set,e=this.app.vault.getMarkdownFiles();for(let s of e){let n=this.app.metadataCache.getFileCache(s);if(n!=null&&n.links)for(let i of n.links){let o=i.link.split("|")[0].trim();t.includes(o)||r.add(o)}}return[...t,...r]}destroy(){this.inputEl.removeEventListener("input",this.inputHandler),this.inputEl.removeEventListener("keydown",this.keydownHandler)}onInput(){let a=this.inputEl.value.toLowerCase();this.items=this.getAllLinkTargets().filter(t=>t.toLowerCase().includes(a)),this.renderSuggestions()}renderSuggestions(){if(this.suggestionsEl.empty(),this.items.length===0){this.suggestionsEl.style.display="none";return}this.suggestionsEl.style.display="block";let a=this.containerEl.getBoundingClientRect(),t=this.inputEl.getBoundingClientRect(),r=t.bottom-a.top+50,e=t.left-a.left;this.suggestionsEl.style.top=`${r}px`,this.suggestionsEl.style.left=`${e}px`,this.suggestionsEl.style.width=`${t.width}px`;for(let s=0;s<this.items.length;s++){let n=this.items[s],i=this.suggestionsEl.createDiv({text:n,cls:"suggestion-item"});i.style.padding="6px 12px",i.style.cursor="pointer",s===this.selectedIndex&&(i.style.backgroundColor="var(--background-secondary)"),i.addEventListener("click",()=>{this.inputEl.value=n,this.suggestionsEl.style.display="none",this.inputEl.focus()}),i.addEventListener("mouseover",()=>{this.selectedIndex=s,this.highlightSelected()})}}highlightSelected(){this.suggestionsEl.querySelectorAll(".suggestion-item").forEach((t,r)=>{r===this.selectedIndex?t.style.backgroundColor="var(--background-secondary)":t.style.backgroundColor=""})}onKeyDown(a){if(a.key==="ArrowDown")a.preventDefault(),this.selectedIndex=Math.min(this.selectedIndex+1,this.items.length-1),this.highlightSelected();else if(a.key==="ArrowUp")a.preventDefault(),this.selectedIndex=Math.max(this.selectedIndex-1,-1),this.highlightSelected();else if(a.key==="Enter"&&this.selectedIndex>=0){a.preventDefault();let t=this.items[this.selectedIndex];this.inputEl.value=t,this.suggestionsEl.style.display="none",this.onSelectCallback(t)}else a.key==="Enter"?(a.preventDefault(),this.onSelectCallback(this.inputEl.value)):a.key==="Escape"&&(this.suggestionsEl.style.display="none")}},C=class extends m.Plugin{async onload(){this.registerView(E,a=>new w(a)),this.addCommand({id:"open-search-view",name:"Open Search Panel",callback:()=>{this.activateView()}})}async activateView(){this.app.workspace.detachLeavesOfType(E);let a=this.app.workspace.getRightLeaf(!1);a&&(await a.setViewState({type:E,active:!0}),this.app.workspace.revealLeaf(a))}onunload(){this.app.workspace.detachLeavesOfType(E)}};
